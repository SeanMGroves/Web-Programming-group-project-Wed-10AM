<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>

    <link rel="stylesheet" href="loginPg.css"> 
</head>

<body>

    <div id="formContainer">
        <form id="resetForm">
            <h1>Reset Password</h1>

            <label for="resetTrn">Enter your TRN</label>
            <input type="text" id="resetTrn" placeholder="000-000-000" required>

            <label for="newPass">New Password</label>
            <div class="password-wrapper">
                <input type="password" id="newPass" required>
                <span id="toggleNewPass" class="eye">üëÅÔ∏è</span>
            </div>

            <label for="confirmNewPass">Confirm New Password</label>
            <div class="password-wrapper">
                <input type="password" id="confirmNewPass" required>
                <span id="toggleConfirmPass" class="eye">üëÅÔ∏è</span>
            </div>

            <button type="button" id="resetBtn">Reset Password</button>
            <button type="reset">Clear</button>

            <p>
                Return to Login? 
                <a href="loginPg.html">Click here</a>
            </p>
        </form>
    </div>

    <script>
        // SHOW / HIDE PASSWORD
        function toggleVisibility(toggleId, fieldId) {
            const toggle = document.getElementById(toggleId);
            const field = document.getElementById(fieldId);

            toggle.addEventListener("click", () => {
                field.type = field.type === "password" ? "text" : "password";
                toggle.textContent = field.type === "password" ? "üëÅÔ∏è" : "üôà";
            });
        }

        toggleVisibility("toggleNewPass", "newPass");
        toggleVisibility("toggleConfirmPass", "confirmNewPass");

        // RESET PASSWORD FUNCTION
        const resetBtn = document.getElementById("resetBtn");

        resetBtn.addEventListener("click", () => {
            const trn = document.getElementById("resetTrn").value.trim();
            const pass1 = document.getElementById("newPass").value.trim();
            const pass2 = document.getElementById("confirmNewPass").value.trim();

            if (trn === "" || pass1 === "" || pass2 === "") {
                alert("All fields are required.");
                return;
            }

            if (pass1 !== pass2) {
                alert("Passwords do not match.");
                return;
            }

            // Get registration data
            let users = JSON.parse(localStorage.getItem("RegistrationData")) || [];

            // Find the user by TRN
            const userIndex = users.findIndex(u => u.trn === trn);

            if (userIndex === -1) {
                alert("TRN not found. Please check your TRN.");
                return;
            }

            // Update password
            users[userIndex].password = pass1;

            // Save updated data
            localStorage.setItem("RegistrationData", JSON.stringify(users));

            alert("Password reset successfully!");

            // Redirect back to login page
            window.location.href = "loginPg.html";
        });
    </script>
</body>
</html>
